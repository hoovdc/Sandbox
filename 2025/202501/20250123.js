//Generated by Grok2 on 20250123
//Google Apps Script to backup a range of values from an Excel file to a Google Sheets file

function createGSheetBackupWithRange() {
    // Original file location
    var originalFolder = DriveApp.getFolderById('x'); 
    var originalFile = originalFolder.getFilesByName('x').next(); 
  
    // Backup folder location
    var backupFolder = DriveApp.getFolderById('x'); 
    Logger.log('Backup Folder Name: ' + backupFolder.getName()); // Log to ensure we have the correct folder
    
    // Current date for naming
    var date = new Date();
    var dateString = Utilities.formatDate(date, Session.getScriptTimeZone(), 'yyyyMMdd');
    var newFileName = `x_${dateString}_Backup`;
  
    // Define the sheet name and ranges to copy
    var sourceSheetName = 'x';   // Name of the sheet (tab) to copy from
    var rangesToCopy = ['A3:A', 'I3:N']; 
    
    // Convert the XLSX file to Google Sheets format for data access
    var excelBlob = originalFile.getBlob();
    var resource = {
      title: newFileName,
      mimeType: MimeType.GOOGLE_SHEETS,
      parents: [{id: backupFolder.getId()}]
    };
    var optionalArgs = {
      convert: true
    };
    
    // Create and immediately convert to Google Sheets in backup folder
    var newBackupFile = Drive.Files.create(resource, excelBlob, optionalArgs);
    
    // Get the source spreadsheet to copy from
    var sourceSpreadsheet = SpreadsheetApp.openById(newBackupFile.id);
    var sourceSheet = sourceSpreadsheet.getSheetByName(sourceSheetName);
    
    // Get the displayed values from both ranges
    var rangeA = sourceSheet.getRange(rangesToCopy[0]).getDisplayValues();
    var rangeItoN = sourceSheet.getRange(rangesToCopy[1]).getDisplayValues();
    
    // Delete the temporary converted file as we don't need it anymore
    DriveApp.getFileById(newBackupFile.id).setTrashed(true);
    
    // Create a new blank spreadsheet in the backup folder
    var newBackupSheet = SpreadsheetApp.create(newFileName);
    var backupFile = DriveApp.getFileById(newBackupSheet.getId());
    backupFile.moveTo(backupFolder);
    
    // Get the first sheet of the new spreadsheet
    var backupSheet = newBackupSheet.getSheets()[0];
    backupSheet.setName(sourceSheetName);
  
    // Paste the values into the backup sheet
    if (rangeItoN && rangeItoN.length > 0) {
      // Set range A in column 1
      backupSheet.getRange(1, 1, rangeA.length, 1).setValues(rangeA);
      // Set range I:N starting at column 2 (adjacent to A)
      backupSheet.getRange(1, 2, rangeItoN.length, rangeItoN[0].length).setValues(rangeItoN);
      Logger.log('Data set in backup sheet');
    } else {
      Logger.log('No data found in the specified ranges');
    }
  
    // Remove any additional sheets if they exist
    var sheets = newBackupSheet.getSheets();
    for (var i = sheets.length - 1; i >= 0; i--) {
      if (sheets[i].getName() !== sourceSheetName) {
        newBackupSheet.deleteSheet(sheets[i]);
      }
    }
  
    Logger.log('Google Sheets Backup created with range ' + rangesToCopy.join(', ') + ' from ' + sourceSheetName + ': ' + newFileName);
  }